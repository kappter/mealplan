<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meal Randomizer</title>
  <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .ingredient-card {
      transition: transform 0.3s ease-in-out;
    }
    .ingredient-card:hover {
      transform: translateY(-10px);
    }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-4">
    <!-- Displaying the app title -->
    <h1 class="text-3xl font-bold text-center mb-6">Meal Randomizer</h1>

    <!-- Handling category selection -->
    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Select Category</h2>
      <div class="flex space-x-4">
        <button id="all-btn" class="category-btn bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">All</button>
        <button id="appetizer-btn" class="category-btn bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Appetizer</button>
        <button id="side-btn" class="category-btn bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Side</button>
        <button id="entree-btn" class="category-btn bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Entree</button>
      </div>
    </div>

    <!-- Displaying ingredient selection -->
    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-2">Select an Ingredient</h2>
      <div id="ingredient-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
    </div>

    <!-- Displaying randomize button -->
    <div class="text-center mb-6">
      <button id="randomize-btn" class="bg-green-500 text-white px-6 py-3 rounded hover:bg-green-600">Randomize Meal</button>
    </div>

    <!-- Displaying randomized meal result -->
    <div id="result" class="bg-white p-6 rounded shadow-md hidden">
      <h2 class="text-xl font-semibold mb-2">Your Meal</h2>
      <p id="dish-name" class="text-lg font-bold"></p>
      <p id="dish-description" class="text-gray-700 mb-4"></p>
      <p id="search-prompt" class="text-blue-600 italic"></p>
    </div>

    <!-- Showing loading state -->
    <div id="loading" class="text-center text-gray-600">Loading dish data...</div>
  </div>

  <script>
    // Simulating unified CSV data (combining provided CSVs with main_ingredients)
    const simulatedCsvData = `
term,definition,category,main_ingredients
Hamburger,A grilled beef patty served in a bun with various toppings.,Entree,beef
Cheeseburger,A hamburger topped with one or more slices of cheese.,Entree,beef,cheese
Fried Chicken,Chicken pieces breaded and deep-fried until crispy.,Entree,chicken
Eggplant Parmesan,Breaded eggplant with marinara and cheese.,Entree,eggplant
Mozzarella Sticks,Breaded and fried mozzarella cheese, served with marinara sauce for dipping.,Appetizer,cheese
Buffalo Wings,Spicy chicken wings coated in a tangy, hot sauce, typically served with celery and blue cheese or ranch dressing.,Appetizer,chicken
Mashed Potatoes,Creamy mashed potatoes often served with gravy.,Side,potatoes
French Fries,Deep-fried potato strips, crispy on the outside and soft inside.,Side,potatoes
Green Beans,Cooked or sautÃ©ed green beans, often seasoned or with almonds.,Side,green beans
Spinach Artichoke Dip,Creamy dip made with spinach, artichoke hearts, cream cheese, and parmesan, served warm with chips or bread.,Appetizer,spinach,artichoke
`;

    // Initializing state
    let dishes = [];
    let selectedCategory = 'All';
    let selectedIngredient = null;

    // Parsing CSV data
    Papa.parse(simulatedCsvData, {
      header: true,
      skipEmptyLines: true,
      transformHeader: (header) => header.trim().replace(/^"|"$/g, ''),
      transform: (value) => value.trim().replace(/^"|"$/g, ''),
      complete: (results) => {
        dishes = results.data.map(row => ({
          term: row['term'],
          definition: row['definition'],
          category: row['category'],
          main_ingredients: row['main_ingredients'].split(',').map(i => i.trim())
        }));
        document.getElementById('loading').classList.add('hidden');
        renderIngredients();
      },
      error: (err) => {
        console.error('Error parsing CSV:', err);
        document.getElementById('loading').textContent = 'Error loading data';
      }
    });

    // Extracting unique ingredients
    function getUniqueIngredients() {
      const ingredients = new Set();
      dishes.forEach(dish => {
        dish.main_ingredients.forEach(ingredient => ingredients.add(ingredient));
      });
      return Array.from(ingredients);
    }

    // Rendering ingredient cards
    function renderIngredients() {
      const ingredientList = document.getElementById('ingredient-list');
      ingredientList.innerHTML = '';
      const ingredients = getUniqueIngredients();
      ingredients.forEach(ingredient => {
        const card = document.createElement('div');
        card.className = 'ingredient-card bg-blue-100 p-4 rounded cursor-pointer hover:bg-blue-200';
        card.textContent = ingredient.charAt(0).toUpperCase() + ingredient.slice(1);
        card.addEventListener('click', () => {
          selectedIngredient = ingredient;
          document.querySelectorAll('.ingredient-card').forEach(c => c.classList.remove('bg-blue-300'));
          card.classList.add('bg-blue-300');
        });
        ingredientList.appendChild(card);
      });
    }

    // Handling category button clicks
    document.querySelectorAll('.category-btn').forEach(button => {
      button.addEventListener('click', () => {
        selectedCategory = button.textContent;
        document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('bg-blue-600'));
        button.classList.add('bg-blue-600');
      });
    });

    // Randomizing a meal
    document.getElementById('randomize-btn').addEventListener('click', () => {
      const filteredDishes = dishes.filter(dish => {
        const categoryMatch = selectedCategory === 'All' || dish.category === selectedCategory;
        const ingredientMatch = !selectedIngredient || dish.main_ingredients.includes(selectedIngredient);
        return categoryMatch && ingredientMatch;
      });

      if (filteredDishes.length === 0) {
        document.getElementById('result').classList.add('hidden');
        alert('No dishes match your selection.');
        return;
      }

      const randomDish = filteredDishes[Math.floor(Math.random() * filteredDishes.length)];
      document.getElementById('dish-name').textContent = randomDish.term;
      document.getElementById('dish-description').textContent = randomDish.definition;
      document.getElementById('search-prompt').textContent = `Search for: recipe for ${randomDish.term}`;
      document.getElementById('result').classList.remove('hidden');
    });
  </script>
</body>
</html>